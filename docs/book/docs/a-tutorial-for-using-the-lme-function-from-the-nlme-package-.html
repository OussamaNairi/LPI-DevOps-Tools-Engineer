<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 3 A tutorial for using the lme function from the nlme package. | PSYC 7709: Using R for Reproducible Research</title>
  <meta name="description" content="Student contributed chapters about various R packages">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 3 A tutorial for using the lme function from the nlme package. | PSYC 7709: Using R for Reproducible Research" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Student contributed chapters about various R packages" />
  <meta name="github-repo" content="CrumpLab/OER_bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 A tutorial for using the lme function from the nlme package. | PSYC 7709: Using R for Reproducible Research" />
  
  <meta name="twitter:description" content="Student contributed chapters about various R packages" />
  

<meta name="author" content="Matthew Crump">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="bootstrapped-mediation-tutorial.html">
<link rel="next" href="data-shaping-using-reshape2-and-stats-packages.html">
<script src="libs/jquery-3.2.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<link href="libs/handsontable-6.1.1/handsontable.full.min.css" rel="stylesheet" />
<script src="libs/handsontable-6.1.1/handsontable.full.min.js"></script>
<script src="libs/handsontable-6.1.1/all.min.js"></script>
<script src="libs/numbro.languages-2.0.6/languages.min.js"></script>
<script src="libs/chroma-1.3.3/chroma.min.js"></script>
<script src="libs/sparkline-2.1.2/jquery.sparkline.min.js"></script>
<link href="libs/rhandsontable-0.3.7/rhandsontable.css" rel="stylesheet" />
<script src="libs/rhandsontable-binding-0.3.7/rhandsontable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-79429674-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-79429674-2');
</script>


<script type="text/javascript">
mattcrump=1;
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">PSYC 7709: Using R for Reproducible Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="bootstrapped-mediation-tutorial.html"><a href="bootstrapped-mediation-tutorial.html"><i class="fa fa-check"></i><b>2</b> Bootstrapped Mediation Tutorial</a></li>
<li class="chapter" data-level="3" data-path="a-tutorial-for-using-the-lme-function-from-the-nlme-package-.html"><a href="a-tutorial-for-using-the-lme-function-from-the-nlme-package-.html"><i class="fa fa-check"></i><b>3</b> A tutorial for using the lme function from the nlme package.</a></li>
<li class="chapter" data-level="4" data-path="data-shaping-using-reshape2-and-stats-packages.html"><a href="data-shaping-using-reshape2-and-stats-packages.html"><i class="fa fa-check"></i><b>4</b> Data Shaping using Reshape(2) and Stats Packages</a></li>
<li class="chapter" data-level="5" data-path="how-to-annotate-a-graph-using-gg-signif.html"><a href="how-to-annotate-a-graph-using-gg-signif.html"><i class="fa fa-check"></i><b>5</b> How to Annotate a Graph Using GG Signif"</a></li>
<li class="chapter" data-level="6" data-path="leaflet-package.html"><a href="leaflet-package.html"><i class="fa fa-check"></i><b>6</b> Leaflet Package</a></li>
<li class="chapter" data-level="7" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>7</b> ggplot2</a></li>
<li class="chapter" data-level="8" data-path="forcats-tutorial.html"><a href="forcats-tutorial.html"><i class="fa fa-check"></i><b>8</b> Forcats tutorial</a></li>
<li class="chapter" data-level="9" data-path="sf-simple-features-tutorial.html"><a href="sf-simple-features-tutorial.html"><i class="fa fa-check"></i><b>9</b> SF simple features tutorial</a></li>
<li class="chapter" data-level="10" data-path="psych-package.html"><a href="psych-package.html"><i class="fa fa-check"></i><b>10</b> “psych” Package</a></li>
<li class="chapter" data-level="11" data-path="imager-tutorial.html"><a href="imager-tutorial.html"><i class="fa fa-check"></i><b>11</b> Imager Tutorial</a></li>
<li class="chapter" data-level="12" data-path="animal-tracking-with-trajr.html"><a href="animal-tracking-with-trajr.html"><i class="fa fa-check"></i><b>12</b> Animal Tracking with TRAJR</a></li>
<li class="chapter" data-level="13" data-path="knitr.html"><a href="knitr.html"><i class="fa fa-check"></i><b>13</b> Knitr</a></li>
<li class="chapter" data-level="14" data-path="creating-your-own-html-widget.html"><a href="creating-your-own-html-widget.html"><i class="fa fa-check"></i><b>14</b> Creating your own html widget</a></li>
<li class="chapter" data-level="15" data-path="network-analysis-tutorial.html"><a href="network-analysis-tutorial.html"><i class="fa fa-check"></i><b>15</b> Network Analysis tutorial</a></li>
<li class="chapter" data-level="16" data-path="rhandsontable-package.html"><a href="rhandsontable-package.html"><i class="fa fa-check"></i><b>16</b> Rhandsontable Package</a></li>
<li class="chapter" data-level="" data-path="references-5.html"><a href="references-5.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">PSYC 7709: Using R for Reproducible Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="a-tutorial-for-using-the-lme-function-from-the-nlme-package." class="section level1">
<h1><span class="header-section-number">Chapter 3</span> A tutorial for using the lme function from the nlme package.</h1>
<p><strong>Author: Melissa Horger</strong></p>
<div id="the-nlme-package" class="section level2">
<h2><span class="header-section-number">3.1</span> The nlme package</h2>
<p><strong>nlme is a package for fitting and comparing linear and nonlinear mixed effects models.</strong></p>
<p>It let’s you specify variance-covariance structures for the residuals and is well suited for repeated measure or longitudinal designs.</p>
<div id="similar-packages" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Similar packages</h3>
<p>One similar package is lme4.
It allows you to fit outcomes whose distribution is not Gaussian and crossed random effects.
Some pros include that it stores data more effiently due to the use of sparse matrices and it works well with clustered data sets.</p>
</div>
<div id="whats-included-in-nlme" class="section level3">
<h3><span class="header-section-number">3.1.2</span> What’s included in nlme?</h3>
<p>nlme contains sample data, statistical functions, matrices, and a lattice framework.</p>
<p><strong>Examples of sample data</strong></p>
<ol style="list-style-type: decimal">
<li>MathAchSchool
<ul>
<li>A dataset (160x7) that contains school-level demographic data such as student enrollment, academic progress, and SES.</li>
</ul></li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nlme)
<span class="kw">print</span>(MathAchSchool[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,])</code></pre>
<pre><code>##      School Size   Sector PRACAD DISCLIM HIMINTY MEANSES
## 1224   1224  842   Public   0.35   1.597       0  -0.428
## 1288   1288 1855   Public   0.27   0.174       0   0.128
## 1296   1296 1719   Public   0.32  -0.137       1  -0.420
## 1308   1308  716 Catholic   0.96  -0.622       0   0.534
## 1317   1317  455 Catholic   0.95  -1.694       1   0.351</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>BodyWeight
<ul>
<li>A data set (176x4) describing the weight of rats over time while consuming different diets.</li>
</ul></li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(BodyWeight[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,])</code></pre>
<pre><code>## Grouped Data: weight ~ Time | Rat
##   weight Time Rat Diet
## 1    240    1   1    1
## 2    250    8   1    1
## 3    255   15   1    1
## 4    260   22   1    1
## 5    262   29   1    1</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Earthquake
<ul>
<li>A dataset (182x5) listing seismic measurements of 23 large earthquakes in western North America between 1940 and 1980</li>
</ul></li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(Earthquake[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,])</code></pre>
<pre><code>## Grouped Data: accel ~ distance | Quake
##     Quake Richter distance soil accel
## 132    20       5      7.5    1 0.264
## 133    20       5      8.8    1 0.263
## 134    20       5      8.9    1 0.230
## 135    20       5      9.4    1 0.147
## 136    20       5      9.7    1 0.286</code></pre>
<p><strong>Examples of functions</strong>
1. anova.lme
- This compares the likelihoods of fitted models. It will produce an AIC and BIC and can be used to compare null and predictive models or models with different predictors and/or interactions.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova.lme</span>(object, ..., <span class="dt">test=</span><span class="ot">TRUE</span>,<span class="dt">type =</span> <span class="st">&quot;sequential/marginal&quot;</span>, adjustSigma, Terms, L, verbose)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>corMatrix
- A function to generate the correlation matrix of an object/dataset.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">corMatrix</span>(object, ...)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>gapply
- Applies a function to a distinct set of rows in a data frame.
- To use this, the rows must first be identified using the “groups” function</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gapply</span>(object, which, FUN, form, level, groups, .)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>lme
- We will learn about this function extensively in the following sections</li>
</ol>
</div>
<div id="using-the-nlme-package" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Using the nlme package</h3>
<div id="begin-by-installing-the-nlme-package" class="section level4">
<h4><span class="header-section-number">3.1.3.1</span> Begin by installing the nlme package</h4>
<p>Found on the CRAN repository</p>
<p>Website: <a href="https://svn.r-project.org/R-packages/trunk/nlme" class="uri">https://svn.r-project.org/R-packages/trunk/nlme</a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;nlme&quot;</span>)</code></pre>
</div>
<div id="load-the-package-and-other-relevant-packages" class="section level4">
<h4><span class="header-section-number">3.1.3.2</span> Load the package (and other relevant packages)</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(nlme)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(knitr)</code></pre>
</div>
</div>
</div>
<div id="the-lme-function" class="section level2">
<h2><span class="header-section-number">3.2</span> The lme function</h2>
<p>This generic function fits a linear mixed-effects model in the formulation described in Laird and Ware (1982) but allowing for nested random effects. The within-group errors are allowed to be correlated and/or have unequal variances.</p>
<div id="some-important-considerations" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Some important considerations</h3>
<ol style="list-style-type: decimal">
<li><p>Need repeated measures from a single subject The data may be longitudinal, but they also may not.</p></li>
<li><p>Can account for correlations within individuals within the random effects</p></li>
<li><p>Uses maximum likelihood estimates</p></li>
</ol>
</div>
<div id="the-arguments-for-this-function" class="section level3">
<h3><span class="header-section-number">3.2.2</span> The arguments for this function</h3>
<p>lme(model, data, fixed, random, groups, start, correlation, weights,
subset, method, na.action, naPattern, control, verbose)</p>
</div>
</div>
<div id="an-example-does-the-number-of-daily-naps-impact-infant-performance-on-a-thing" class="section level2">
<h2><span class="header-section-number">3.3</span> <strong>An example: Does the number of daily naps impact infant performance on a thing?</strong></h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#creating a data set </span>

Subs &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)), <span class="dv">4</span>)

Month &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>), <span class="dv">10</span>), <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">5</span>), <span class="dv">10</span>), <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">10</span>), <span class="dv">10</span>), <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">15</span>), <span class="dv">10</span>))

Naps &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">3</span>), <span class="dv">10</span>), <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span> ,<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span> )

Napsfactor &lt;-<span class="st"> </span><span class="kw">as.factor</span>(Naps)

<span class="co">#Let&#39;s assume that infants&#39; performance will get better with time. I altered the possible sampling distributions to reflect this. </span>

scores &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">runif</span>(<span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">7</span>), <span class="kw">runif</span>(<span class="dv">10</span>, <span class="dv">8</span>, <span class="dv">15</span>), <span class="kw">runif</span>(<span class="dv">10</span>, <span class="dv">16</span>, <span class="dv">22</span>), <span class="kw">runif</span>(<span class="dv">10</span>, <span class="dv">23</span>, <span class="dv">30</span>))


dataset &lt;-<span class="st"> </span><span class="kw">data.frame</span>(Subs, Month, Naps, scores, Napsfactor)

<span class="co">#save(dataset,file=&quot;horger.RData&quot;)</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/horger.RData&quot;</span>)

<span class="co">#Data should be set up in long format and look similar to this. </span>
<span class="kw">print</span>(dataset)</code></pre>
<pre><code>##    Subs Month Naps    scores Napsfactor
## 1     1     1    3  1.204228          3
## 2     2     1    3  4.215435          3
## 3     3     1    3  6.530265          3
## 4     4     1    3  3.651179          3
## 5     5     1    3  2.085147          3
## 6     6     1    3  4.913243          3
## 7     7     1    3  2.683738          3
## 8     8     1    3  3.372563          3
## 9     9     1    3  4.621265          3
## 10   10     1    3  3.105155          3
## 11    1     5    2 13.572888          2
## 12    2     5    3 10.021787          3
## 13    3     5    2 14.754621          2
## 14    4     5    1 11.818922          1
## 15    5     5    2 13.203504          2
## 16    6     5    3 12.327272          3
## 17    7     5    2 13.829133          2
## 18    8     5    3  9.144146          3
## 19    9     5    2  9.209897          2
## 20   10     5    3  8.146771          3
## 21    1    10    2 20.521925          2
## 22    2    10    2 19.207385          2
## 23    3    10    2 19.908420          2
## 24    4    10    2 21.929604          2
## 25    5    10    3 16.036066          3
## 26    6    10    3 19.170270          3
## 27    7    10    2 16.097766          2
## 28    8    10    2 17.480285          2
## 29    9    10    1 20.111028          1
## 30   10    10    2 18.278805          2
## 31    1    15    3 23.089659          3
## 32    2    15    1 26.585482          1
## 33    3    15    2 24.839186          2
## 34    4    15    2 24.917255          2
## 35    5    15    1 23.046358          1
## 36    6    15    1 28.955977          1
## 37    7    15    2 26.056173          2
## 38    8    15    1 28.870685          1
## 39    9    15    2 26.720957          2
## 40   10    15    1 26.898722          1</code></pre>
<div id="the-experimental-design." class="section level3">
<h3><span class="header-section-number">3.3.1</span> The experimental design.</h3>
<p>This is a 4x3 within subject design.
Infants are assessed at 4 time points - 1 month, 5 months, 10 months, and 15 months.
There are 3 levels of napping - 1, 2, or 3 naps per day.</p>
</div>
<div id="data-analysis" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Data analysis</h3>
<p>We will run a conditional growth model because we are including predictors. Subsequent fixed and random effects are now “conditioned on” the predictors (age and number of naps).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Conditional growth model</span>
tutorial&lt;-<span class="kw">lme</span>(scores <span class="op">~</span><span class="st"> </span>Month <span class="op">*</span><span class="st"> </span>Naps, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>Month <span class="op">|</span><span class="st"> </span>Subs, <span class="dt">data=</span>dataset)


<span class="co">#Because we are using a random sample, may need to rerun the scores several times for this piece of code to run effectively</span></code></pre>
<p><strong>lme(model, random, data)</strong></p>
<p><strong>model</strong> - scores ~ Month * Naps</p>
<p>We expect scores will be influenced by how old infants are (Month) and the number of Naps they take per day. There may be an interaction between these predictors.</p>
<p><strong>random</strong> - random = ~ Month | Subs</p>
<p>Random error comes from the fact that this is a within subjects design. The same infants are assessed at 1 month, 5 months, 10 months, and 15 months.</p>
<p><strong>data</strong> - data=dataset</p>
<p>Using the data set we created previously.</p>
</div>
<div id="displaying-our-results" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Displaying our results</h3>
<pre class="sourceCode r"><code class="sourceCode r">tutorial</code></pre>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: dataset 
##   Log-restricted-likelihood: -81.67538
##   Fixed: scores ~ Month * Naps 
## (Intercept)       Month        Naps  Month:Naps 
##  10.8206754   1.1464573  -2.8094967   0.1105195 
## 
## Random effects:
##  Formula: ~Month | Subs
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev       Corr  
## (Intercept) 4.728576e-01 (Intr)
## Month       1.238514e-05 0     
## Residual    1.732905e+00       
## 
## Number of Observations: 40
## Number of Groups: 10</code></pre>
<p>We can move the results to a nicer table using the summary function</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#summarize an lme object - our solution</span>
tut &lt;-<span class="st"> </span><span class="kw">summary</span>(tutorial)
tabl =<span class="st"> </span>tut<span class="op">$</span>tTable 
tabl </code></pre>
<pre><code>##                  Value  Std.Error DF   t-value      p-value
## (Intercept) 10.8206754 2.59927655 27  4.162957 2.872090e-04
## Month        1.1464573 0.21022323 27  5.453523 9.028044e-06
## Naps        -2.8094967 0.92823701 27 -3.026702 5.381092e-03
## Month:Naps   0.1105195 0.08248428 27  1.339886 1.914511e-01</code></pre>
<p>From this analysis, we would conclude that there is a main effect of age, infants performance improved with age, but there is no effect of number of naps. It was trending in the correct direction as the only negative slope.</p>
</div>
<div id="graphing-our-results" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Graphing our results</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
plot&lt;-<span class="st"> </span><span class="kw">ggplot</span>(dataset, <span class="kw">aes</span>(<span class="dt">x=</span>Month, <span class="dt">y=</span>scores,  <span class="dt">color=</span>Napsfactor, <span class="dt">shape =</span> Napsfactor, <span class="dt">group =</span> Subs), <span class="kw">xlim</span>(<span class="dv">1</span>, <span class="dv">15</span>), <span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">25</span>), <span class="kw">xlab</span>(Month) ) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>)

plot <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">name=</span><span class="st">&quot;Age (in months)&quot;</span>, <span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">15</span>), <span class="dt">breaks =</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name=</span><span class="st">&quot;Scores&quot;</span>, <span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">30</span>))</code></pre>
<p><img src="7709_bookdown_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>This kind of graph allows us to see the developmental trajectory of individual infants. It highlights the fact that there are 2 developmental trends occuring here- Infants’ performance on the assessment is improving with time and the average number of naps they take is decreasing with time.</p>
</div>
</div>
<div id="continuing-our-example-single-main-effect-versus-two-main-effects-or-an-interaction" class="section level2">
<h2><span class="header-section-number">3.4</span> Continuing our example: Single main effect versus two main effects or an interaction</h2>
<p>When making the original data set, I intentionally biased the data to show a developmental curve by increasing the sampling distribution for each age range. I could do something similar to bias our data to support the impact of taking fewer naps</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Create a new data set </span>
Subs &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)), <span class="dv">4</span>)

Month &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>), <span class="dv">10</span>), <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">5</span>), <span class="dv">10</span>), <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">10</span>), <span class="dv">10</span>), <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">15</span>), <span class="dv">10</span>))

Naps &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">3</span>), <span class="dv">10</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span> ,<span class="dv">2</span>,<span class="dv">2</span>,  <span class="dv">2</span>, <span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)
Napsfactor &lt;-<span class="st"> </span><span class="kw">as.factor</span>(Naps)

secondscores &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">runif</span>(<span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">10</span>), <span class="kw">runif</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">10</span>),<span class="kw">runif</span>(<span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">17</span>), <span class="kw">runif</span>(<span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">15</span>), <span class="kw">runif</span>(<span class="dv">5</span>, <span class="dv">14</span>, <span class="dv">22</span>), <span class="kw">runif</span>(<span class="dv">2</span>, <span class="dv">20</span>, <span class="dv">25</span>), <span class="kw">runif</span>(<span class="dv">5</span>, <span class="dv">18</span>, <span class="dv">23</span>), <span class="kw">runif</span>(<span class="dv">4</span>,<span class="dv">22</span>, <span class="dv">27</span>), <span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">27</span>, <span class="dv">30</span>) )</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">seconddataset &lt;-<span class="st"> </span><span class="kw">data.frame</span>(Subs, Month, Naps, secondscores, Napsfactor)
<span class="co">#save(seconddataset, file=&quot;horger2.RData&quot;)</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/horger2.Rdata&quot;</span>)
<span class="kw">print</span>(seconddataset)</code></pre>
<pre><code>##    Subs Month Naps secondscores Napsfactor
## 1     1     1    3     7.621794          3
## 2     2     1    3     7.794263          3
## 3     3     1    3     3.168637          3
## 4     4     1    3     3.415735          3
## 5     5     1    3     8.465790          3
## 6     6     1    3     7.971604          3
## 7     7     1    3     8.553510          3
## 8     8     1    3     7.115589          3
## 9     9     1    3     8.379775          3
## 10   10     1    3     8.840234          3
## 11    1     5    3     7.416176          3
## 12    2     5    3     7.583637          3
## 13    3     5    3     5.250097          3
## 14    4     5    3     6.014483          3
## 15    5     5    3     5.372417          3
## 16    6     5    2     9.927262          2
## 17    7     5    2    12.315161          2
## 18    8     5    2    13.054388          2
## 19    9     5    2    15.337895          2
## 20   10     5    2     9.226133          2
## 21    1    10    3    10.863713          3
## 22    2    10    3    12.495100          3
## 23    3    10    3    10.480098          3
## 24    4    10    2    20.347891          2
## 25    5    10    2    16.173209          2
## 26    6    10    2    20.144221          2
## 27    7    10    2    14.771556          2
## 28    8    10    2    20.676701          2
## 29    9    10    1    23.473947          1
## 30   10    10    1    21.244746          1
## 31    1    15    2    22.276560          2
## 32    2    15    2    21.167274          2
## 33    3    15    2    22.405964          2
## 34    4    15    2    19.556372          2
## 35    5    15    2    18.950262          2
## 36    6    15    1    25.115982          1
## 37    7    15    1    23.578970          1
## 38    8    15    1    23.747330          1
## 39    9    15    1    26.066104          1
## 40   10    15    1    28.513882          1</code></pre>
<div id="did-the-manipulation-work" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Did the manipulation work?</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Summary stats from our first dataset</span>
demos &lt;-<span class="st"> </span>dataset <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(Month, Naps) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_score =</span> <span class="kw">mean</span>(scores, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))



<span class="co">#Summary stats from our second dataset</span>
seconddemos &lt;-<span class="st"> </span>seconddataset <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(Month, Naps) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_secondscore =</span> <span class="kw">mean</span>(secondscores, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))


<span class="kw">print</span>(demos)</code></pre>
<pre><code>## # A tibble: 10 x 3
## # Groups:   Month [4]
##    Month  Naps mean_score
##    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     1     3       3.64
##  2     5     1      11.8 
##  3     5     2      12.9 
##  4     5     3       9.91
##  5    10     1      20.1 
##  6    10     2      19.1 
##  7    10     3      17.6 
##  8    15     1      26.9 
##  9    15     2      25.6 
## 10    15     3      23.1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(seconddemos)</code></pre>
<pre><code>## # A tibble: 8 x 3
## # Groups:   Month [4]
##   Month  Naps mean_secondscore
##   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;
## 1     1     3             7.13
## 2     5     2            12.0 
## 3     5     3             6.33
## 4    10     1            22.4 
## 5    10     2            18.4 
## 6    10     3            11.3 
## 7    15     1            25.4 
## 8    15     2            20.9</code></pre>
<p>It may or may not because we’re still drawing a random sample, but the trend should be clearer than during the first example.</p>
<p>###Now run the analysis again</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Run the analysis again </span>

secondtutorial &lt;-<span class="st"> </span><span class="kw">lme</span>(secondscores <span class="op">~</span><span class="st"> </span>Month <span class="op">*</span><span class="st"> </span>Naps, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>Month <span class="op">|</span><span class="st"> </span>Subs, <span class="dt">data=</span>seconddataset)

secondtutorial</code></pre>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: seconddataset 
##   Log-restricted-likelihood: -90.36513
##   Fixed: secondscores ~ Month * Naps 
## (Intercept)       Month        Naps  Month:Naps 
##  16.8803891   1.0208719  -3.7260738  -0.1487096 
## 
## Random effects:
##  Formula: ~Month | Subs
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev       Corr  
## (Intercept) 1.694427e-04 (Intr)
## Month       2.301061e-15 0     
## Residual    2.291816e+00       
## 
## Number of Observations: 40
## Number of Groups: 10</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Create a table </span>
secondtut&lt;-<span class="st"> </span><span class="kw">summary</span>(secondtutorial)
secondtabl =<span class="st"> </span>secondtut<span class="op">$</span>tTable 
secondtabl </code></pre>
<pre><code>##                  Value Std.Error DF   t-value      p-value
## (Intercept) 16.8803891 4.0453977 27  4.172739 0.0002798284
## Month        1.0208719 0.3172138 27  3.218246 0.0033430373
## Naps        -3.7260738 1.4256854 27 -2.613531 0.0144718579
## Month:Naps  -0.1487096 0.1227206 27 -1.211774 0.2360974216</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Graph the results </span>
secondplot&lt;-
ggplot2<span class="op">::</span><span class="kw">ggplot</span>(seconddataset, <span class="kw">aes</span>(<span class="dt">x=</span>Month, <span class="dt">y=</span>secondscores,  <span class="dt">color=</span>Napsfactor, <span class="dt">shape =</span> Napsfactor, <span class="dt">group=</span>Subs), <span class="kw">xlim</span>(<span class="dv">1</span>, <span class="dv">15</span>), <span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">25</span>), <span class="kw">xlab</span>(Month) ) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>( <span class="dt">color=</span><span class="st">&quot;grey&quot;</span>)

secondplot <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">name=</span><span class="st">&quot;Age (in months)&quot;</span>, <span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">15</span>), <span class="dt">breaks =</span> Month) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name=</span><span class="st">&quot;Scores&quot;</span>, <span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">30</span>))</code></pre>
<p><img src="7709_bookdown_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
</div>
</div>
<div id="plot-the-residuals" class="section level2">
<h2><span class="header-section-number">3.5</span> Plot the residuals</h2>
<p>We can check the residuals to judge the fit of our models. The second tutorial should fit better because we set the data up that way.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(tutorial)</code></pre>
<p><img src="7709_bookdown_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(secondtutorial)</code></pre>
<p><img src="7709_bookdown_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
<p>Remember, for a well fitting regression, we want the plot of our residuals to meet the following criteria:
(1) they’re pretty symmetrically distributed
(2) they’re relatively small and
(3) they don’t follow a clear pattern</p>
<p>The second plot seems to meet these qualifications.</p>
</div>
<div id="writing-up-our-results" class="section level2">
<h2><span class="header-section-number">3.6</span> Writing up our results</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(secondtutorial)</code></pre>
<pre><code>## Linear mixed-effects model fit by REML
##  Data: seconddataset 
##        AIC      BIC    logLik
##   196.7303 209.3984 -90.36513
## 
## Random effects:
##  Formula: ~Month | Subs
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev       Corr  
## (Intercept) 1.694427e-04 (Intr)
## Month       2.301061e-15 0     
## Residual    2.291816e+00       
## 
## Fixed effects: secondscores ~ Month * Naps 
##                 Value Std.Error DF   t-value p-value
## (Intercept) 16.880389  4.045398 27  4.172739  0.0003
## Month        1.020872  0.317214 27  3.218246  0.0033
## Naps        -3.726074  1.425685 27 -2.613531  0.0145
## Month:Naps  -0.148710  0.122721 27 -1.211774  0.2361
##  Correlation: 
##            (Intr) Month  Naps  
## Month      -0.935              
## Naps       -0.985  0.936       
## Month:Naps  0.818 -0.947 -0.861
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -1.6665261 -0.6414693 -0.1440354  0.8827551  1.7514202 
## 
## Number of Observations: 40
## Number of Groups: 10</code></pre>
<p>A linear mixed effects model and conditional growth curve analysis was used to analyze infants’ scores at 1, 5, 10, and 15 months old. Their scores were modeled with fixed effects of Month and Naps (1, 2, or 3) and random error to account for the within subjects design.There was a significant effect of Month- scores increased with age (Estimate= , SE= , p= ).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Estimate = </span>
secondtabl[<span class="dv">2</span>,<span class="dv">1</span>]</code></pre>
<pre><code>## [1] 1.020872</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#SE = </span>
secondtabl[<span class="dv">2</span>,<span class="dv">2</span>]</code></pre>
<pre><code>## [1] 0.3172138</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#p = </span>
secondtabl[<span class="dv">2</span>,<span class="dv">5</span>]</code></pre>
<pre><code>## [1] 0.003343037</code></pre>
<p>There was also a significant effect of Naps with fewer naps associated with better scores over time (Estimate= , SE= , p= ).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Estimate = </span>
secondtabl[<span class="dv">3</span>,<span class="dv">1</span>]</code></pre>
<pre><code>## [1] -3.726074</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#SE = </span>
secondtabl[<span class="dv">3</span>,<span class="dv">2</span>]</code></pre>
<pre><code>## [1] 1.425685</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#p = </span>
secondtabl[<span class="dv">3</span>,<span class="dv">5</span>]</code></pre>
<pre><code>## [1] 0.01447186</code></pre>
<p>The interaction was not significant.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bootstrapped-mediation-tutorial.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-shaping-using-reshape2-and-stats-packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-Horger.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["7709_bookdown.pdf", "7709_bookdown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
